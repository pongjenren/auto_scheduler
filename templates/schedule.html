{% extends "base.html" %}
{% block content %}
<div class="d-flex justify-content-between align-items-center mb-4">
  <h3 class="mb-0">未來四天排程</h3>
  <button class="btn btn-success" id="btn-schedule-now">Scheduling Now</button>
</div>
<div id="schedule-content" class="row row-cols-1 row-cols-md-4 g-3">
  {% for i in range(4) %}
  {% set date = today + timedelta(days=i) %}
  <div class="col">
    <div class="card h-100">
      <div class="card-header text-center fw-bold">
        {{ date.strftime("%m/%d (%a)") }}
      </div>
      <ul class="list-group list-group-flush">
        {% for slot in plan[date.isoformat()] %}
        <li class="list-group-item">
          <span class="badge bg-primary">{{ slot["start"] }} ~ {{ slot["end"] }}</span>
          <div>{{ slot["task"]["title"] }}</div>
        </li>
        {% endfor %}
        {% if not plan[date.isoformat()] %}
        <li class="list-group-item text-center text-muted">— 無排程 —</li>
        {% endif %}
      </ul>
    </div>
  </div>
  {% endfor %}
</div>
{% endblock %}

{% block extra_js %}
<script>
// Scheduling Now 按鈕觸發
document.getElementById('btn-schedule-now').addEventListener('click', async function() {
  const btn = this;
  btn.disabled = true;
  btn.textContent = 'Scheduling...';
  const res = await fetch('/schedule/refresh');
  if (res.ok) {
    location.reload();
  } else {
    alert('Scheduling failed!');
    btn.disabled = false;
    btn.textContent = 'Scheduling Now';
  }
});
</script>
{% endblock %}
